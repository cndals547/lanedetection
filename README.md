# lanedetection
python_opencv를 사용하여 차선감지
1. 개발환경
 - Window10
 - Python 3.6.0
 - Opencv 4.1.0

2. 프로그램 설명
1) 차선을 찾기 위해 첫 번째 단계로 이미지에서 흰색과 노란색만을 먼저 검출한다.
- 이미지에서 흰색과 노란색만을 검출하는 소스코드

• 색상을 더 정확하게 검출해내기 위해 BGR이미지에서 HLS이미지로 변환해주는 
함수를 사용해서 이미지를 변환하고, 변환된 이미지에서 흰색과 노란색을 검출해주는 함수를 사용하여 흰색과 노란색만을 검출한다.

- 결과

• 원본 이미지와 흰색과 노란색을 검출한 이미지를 비교했을 때 색상이 잘 검출됐다.

2) 두 번째 단계에서는 케니 에지 검출(Canny Edge Detection) 알고리즘을 이용하여 
이미지 상에서 에지를 검출한다.
- 케니 에지 검출 알고리즘을 사용하기 위해 먼저 수행해야 할 몇 가지 작업이 있다.
• 첫 번째 작업 : 컬러이미지 → 흑백이미지로 변환
• 두 번째 작업 : 가우시안 블러(Gaussian Blur)를 사용하여 영상의 잡음을 제거하고 
영상을 부드럽게 만든다.

- 케니 에지 검출 알고리즘을 이용하여 에지를 검출하는 소스코드

• Canny Edge를 추출하기 위해 컬러이미지를 흑백이미지로 변환해주는 함수를 
사용하여 이미지를 변환한다.
• 변환된 흑백이미지에 가우시안 필터 함수를 사용하여 이미지의 잡음을 제거하고 
이미지를 더 부드럽게 만들어 준다. 이때 가우시안 필터 함수에서 커널의 크기와 X-축 방향으로의 가우시안 커널 표준편차를 각각 9와 0으로 설정했다.
• 마지막으로 케니 에지 검출 함수를 사용하여 에지를 검출한다. 이때 케니 에지 검출 
함수에서 낮은 값의 임계값과 높은 값의 임계값을 각각 50과 150으로 설정했다.

- 결과

• 케니 에지 검출 알고리즘을 이용하여 에지를 검출한 결과 전 단계에서 검출된 
흰색과 노란색의 경계선이 잘 검출됐다.

3) 세 번째 단계에서는 케니 에지 검출을 이용하여 검출된 에지들 중에서 필요 없는 
에지들을 제거하고 차선만의 에지를 검출하기 위해서 관심영역(ROI, Region Of Interest)을 설정한다.
- 관심영역을 설정하여 차선만의 에지를 검출하는 소스코드

• 도로의 차선을 검출하는 것이 이 보고서의 목표이므로 관심영역 설정 함수를 
사용하여 사다리꼴 모양의 영역을 설정해서 검출된 에지에서 불필요한 에지들을 제거한다.

- 결과

• 관심영역을 설정한 결과 차선 이외의 불필요한 에지들이 제거되었다.

4) 네 번째 단계에서는 허프 변환(Hough Transform)알고리즘을 이용하여 직선을 검출한다.
- 허프 변환을 이용하여 직선을 검출하는 소스코드

• 허프 변환에서 선분을 출력해주는 HoughLinesP() 함수와 직선을 그려주는 함수를 
이용하여 직선을 검출한다.

- 결과

• 허프 변환 알고리즘을 사용한 결과 빨강색의 직선이 잘 검출되었다.
5) 다섯 번째 단계에서는 addWeighted() 함수를 사용해서 원본 이미지에 검출된 선을 
허프 변환한 이미지와 겹친다.
- 원본 이미지와 허프 변환한 이미지를 겹치는 소스코드

• 두 이미지를 겹쳐주는 addweighted() 함수를 사용하여 허프 변환 알고리즘을 
사용하여 선분을 검출한 이미지와 원본 이미지를 겹쳐준다.
- 결과

• 두 이미지를 겹친 결과 원본이미지의 차선과 허프 변환 알고리즘을 사용하여 
검출한 선분이 서로 잘 겹쳐져서 검출됐다.

6) 다른 이미지 혹은 곡선에서도 차선을 잘 검출하기 위해서 직선의 기울기를 이용한다.
- 기울기를 이용하여 직선을 검출하는 소스코드

• hough_Transform의 함수에서 적용시킨 후에 직선들의 값들의 평균을 구해서 반환한다. 반환한 값들을 lane_lines의 함수에 집어넣은 후에 make_line_points 함수를 이용해서 왼쪽과 오른쪽 라인들의 점들을 이용하여 x1, y1, x2, y2(왼쪽과 오른쪽라인의 좌표)를 반환시킨다. 이런 좌표값들을 이용하여 선을 만들 수 있다. 
그러하여 기존의 hough_Transform을 적용시킨 이미지에 왼쪽선과 오른쪽 차선을 받은 부분의 함수 lane_lines를 이용하여 그 이미지위에 선을 그린다.

- 결과

• 직선의 기울기를 이용한 결과 차선이 좀 더 명확하게 검출됐다.


7) 차의 중심을 보기 위한 가운데 선을 다시 한 번 그린다.
•마지막으로 차의 중심을 맞추기 위해서 왼쪽 차선과 오른쪽 차선 검출 후에 중간 값을 계산 후에 왼쪽 차선과 오른쪽 차선 중간에 선을 그린다.
